{"paragraphs":[{"text":"%md\nDemo notebook\n====================\nThis notebook has been templated by the developer and to be completed by BA. It contains following sections:\n\n* description (this)\n* release notes\n* extracts locations\n* transform SQL, in the format of: `CREATE OR REPLACE TEMPORARY VIEW xxx AS SELECT...`\n* optional extract-checks, in the format of: `SELECT min(total) > 0 as total_ok FROM xxx`\n* optional transform-checks (same format as extract-checks)\n* optional report (eg. transform result counts)\n\nExtract-checks and transform-check produce visually inspectable format, with true|false results, eg.: \n\nclient_ids_null_less | age_null_less | has_positive_prices\n---------------------|---------------|---------------------\n                true |         false |              false\n\nOverall report can have any information, eg.:\n\nclient_count | item_count | transaction_count\n-------------|------------|-------------------\n         325 |        197 |              3073\n\nFor R&D, each section can be played individually. Releasable notebook should be playable in entirety.","dateUpdated":"2017-04-26T15:30:20+1000","config":{"enabled":true,"tableHide":false,"results":{},"editorMode":"ace/mode/markdown","editorSetting":{"language":"markdown","editOnDblClick":true},"editorHide":true,"colWidth":12},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Demo notebook</h1>\n<p>This notebook has been templated by the developer and to be completed by BA. It contains following sections:</p>\n<ul>\n  <li>description (this)</li>\n  <li>release notes</li>\n  <li>extracts locations</li>\n  <li>transform SQL, in the format of: <code>CREATE OR REPLACE TEMPORARY VIEW xxx AS SELECT...</code></li>\n  <li>optional extract-checks, in the format of: <code>SELECT min(total) &gt; 0 as total_ok FROM xxx</code></li>\n  <li>optional transform-checks (same format as extract-checks)</li>\n  <li>optional report (eg. transform result counts)</li>\n</ul>\n<p>Extract-checks and transform-check produce visually inspectable format, with true|false results, eg.: </p>\n<table>\n  <thead>\n    <tr>\n      <th>client_ids_null_less </th>\n      <th>age_null_less </th>\n      <th>has_positive_prices</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>true </td>\n      <td>false </td>\n      <td>false</td>\n    </tr>\n  </tbody>\n</table>\n<p>Overall report can have any information, eg.:</p>\n<table>\n  <thead>\n    <tr>\n      <th>client_count </th>\n      <th>item_count </th>\n      <th>transaction_count</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>325 </td>\n      <td>197 </td>\n      <td>3073</td>\n    </tr>\n  </tbody>\n</table>\n<p>For R&amp;D, each section can be played individually. Releasable notebook should be playable in entirety.</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1493172926271_1635623096","id":"20170413-123303_62504791","dateCreated":"2017-04-26T12:15:26+1000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:442","user":"anonymous","dateFinished":"2017-04-26T15:30:20+1000","dateStarted":"2017-04-26T15:30:20+1000"},{"text":"%md\nRelease notes\n=============\nv0.0.1\n\n* added extracts: client, item, transaction\n* added transforms: client_spending_count, item_purchase_count, minor_purchase_count","dateUpdated":"2017-04-26T14:50:42+1000","config":{"enabled":true,"tableHide":false,"editorMode":"ace/mode/markdown","results":{},"editorHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Release notes</h1>\n<p>v0.0.1</p>\n<ul>\n  <li>added extracts: client, item, transaction</li>\n  <li>added transforms: client_spending_count, item_purchase_count, minor_purchase_count</li>\n</ul>\n</div>"}]},"apps":[],"jobName":"paragraph_1493172926271_1635623096","id":"20170413-164130_1619390779","dateCreated":"2017-04-26T12:15:26+1000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:443","user":"anonymous","dateFinished":"2017-04-26T14:50:42+1000","dateStarted":"2017-04-26T14:50:42+1000"},{"text":"println(\"Load extracts...\")\nval env = \"dev\" // \"test\"\ndef loadExtracts(viewsAndLocations: (String, String)*) = viewsAndLocations.foreach { case (view, uri) => sqlContext.read.parquet(uri).createOrReplaceTempView(view) }\nloadExtracts(\n    \"client\"      -> s\"hdfs://$env/sales/client_2017\",\n    \"item\"        -> s\"hdfs://$env/sales/item_2017\",\n    \"transaction\" -> s\"hdfs://$env/sales/transaction_2017\",\n    )","dateUpdated":"2017-04-26T15:29:16+1000","config":{"enabled":true,"editorMode":"ace/mode/scala","results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorHide":false,"colWidth":12,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493172926272_1621387386","id":"20170224-125923_495055281","dateCreated":"2017-04-26T12:15:26+1000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:444","user":"anonymous","dateFinished":"2017-04-26T15:28:55+1000","dateStarted":"2017-04-26T15:28:55+1000"},{"text":"%sql\n-- extract-check - client\nSELECT -- null checks\n       (SELECT count(1) FROM client WHERE id IS NULL)   = 0 AS id_null_less,\n       (SELECT count(1) FROM client WHERE name IS NULL) = 0 AS name_null_less,\n       (SELECT count(1) FROM client WHERE age IS NULL)  = 0 AS age_null_less\n","user":"anonymous","dateUpdated":"2017-04-26T14:34:23+1000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":89,"optionOpen":false}}},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493179983140_1484695305","id":"20170426-141303_93655764","dateCreated":"2017-04-26T14:13:03+1000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5247","dateFinished":"2017-04-26T14:34:24+1000","dateStarted":"2017-04-26T14:34:23+1000","errorMessage":""},{"text":"%sql\n-- extract-check - item\nSELECT -- null checks\n      (SELECT count(1) FROM item WHERE id IS NULL)                                     = 0 AS id_null_less,\n      (SELECT count(1) FROM item WHERE name IS NULL)                                   = 0 AS name_null_less,\n      (SELECT count(1) FROM item WHERE price IS NULL)                                  = 0 AS age_null_less,\n      (SELECT count(1) FROM item WHERE for_adults IS NULL)                             = 0 AS for_adults_null_less,\n      -- positive price checks\n      (SELECT count(1) FROM (SELECT CAST(price AS INTEGER) FROM item) WHERE price < 0) = 0 AS has_positive_prices","dateUpdated":"2017-04-26T14:34:23+1000","config":{"enabled":true,"editorMode":"ace/mode/sql","results":{"0":{"graph":{"mode":"table","height":89,"optionOpen":false}}},"editorSetting":{"language":"sql"},"colWidth":12},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493172926272_1621387386","id":"20170413-154435_1307170272","dateCreated":"2017-04-26T12:15:26+1000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:445","user":"anonymous","dateFinished":"2017-04-26T14:34:24+1000","dateStarted":"2017-04-26T14:34:24+1000"},{"text":"%sql\n-- extract-check - transaction\nSELECT -- null checks\n      (SELECT count(1) FROM transaction WHERE client_id IS NULL)                                    = 0 AS client_id_null_less,\n      (SELECT count(1) FROM transaction WHERE item_id IS NULL)                                      = 0 AS item_id_null_less,\n      (SELECT count(1) FROM transaction WHERE quantity IS NULL)                                     = 0 AS quantity_null_less,\n      -- positive price checks\n      (SELECT count(1) FROM (SELECT CAST(quantity AS INTEGER) FROM transaction) WHERE quantity < 0) = 0 AS has_positive_quantity","user":"anonymous","dateUpdated":"2017-04-26T14:34:23+1000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":89,"optionOpen":false}}},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493179976065_1586253690","id":"20170426-141256_1014357490","dateCreated":"2017-04-26T14:12:56+1000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5185","dateFinished":"2017-04-26T14:34:25+1000","dateStarted":"2017-04-26T14:34:24+1000","errorMessage":""},{"text":"%sql\n-- transform - client_spending\nCREATE OR REPLACE TEMPORARY VIEW client_spending AS\nSELECT c.id,\n       c.name,\n       totals.total_spending\n  FROM client c\n       INNER JOIN\n       (SELECT id,\n               SUM(spent) AS total_spending\n          FROM (SELECT typed_client.id,\n                       (typed_item.price * typed_transaction.quantity) AS spent\n                  FROM (SELECT id, name FROM client) AS typed_client\n                       LEFT OUTER JOIN\n                       (SELECT client_id, item_id, CAST(quantity AS INTEGER) FROM transaction) AS typed_transaction\n                       ON typed_transaction.client_id = typed_client.id\n                       LEFT OUTER JOIN\n                       (SELECT id, CAST(price AS INTEGER) FROM item) AS typed_item\n                       ON typed_transaction.item_id = typed_item.id\n               ) GROUP BY id\n         ) AS totals\n         ON c.id = totals.id","dateUpdated":"2017-04-26T14:34:23+1000","config":{"enabled":true,"editorMode":"ace/mode/sql","results":{"0":{"graph":{"mode":"table","height":88,"optionOpen":false}}},"editorSetting":{"language":"sql"},"colWidth":12},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493172926272_1621387386","id":"20170413-154609_1683441788","dateCreated":"2017-04-26T12:15:26+1000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:446","user":"anonymous","dateFinished":"2017-04-26T14:34:25+1000","dateStarted":"2017-04-26T14:34:25+1000"},{"text":"%sql\n-- transform - item_purchase\nCREATE OR REPLACE TEMPORARY VIEW item_purchase AS\nSELECT i.id,\n       i.name,\n       totals.total_purchase\n  FROM item i\n       INNER JOIN\n       (SELECT id,\n               SUM(purchase) AS total_purchase\n          FROM (SELECT typed_client.id,\n                       (typed_item.price * typed_transaction.quantity) AS purchase\n                  FROM (SELECT id, name, CAST(age AS INTEGER) FROM client) AS typed_client\n                       LEFT OUTER JOIN\n                       (SELECT client_id, item_id, CAST(quantity AS INTEGER) FROM transaction) AS typed_transaction\n                       ON typed_transaction.client_id = typed_client.id\n                       LEFT OUTER JOIN\n                       (SELECT id, CAST(price AS INTEGER) FROM item) AS typed_item\n                       ON typed_transaction.item_id = typed_item.id\n               ) GROUP BY id\n         ) AS totals\n         ON i.id = totals.id","dateUpdated":"2017-04-26T14:34:23+1000","config":{"enabled":true,"editorMode":"ace/mode/sql","results":{"0":{"graph":{"mode":"table","height":92,"optionOpen":false}}},"editorSetting":{"language":"sql"},"colWidth":12},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493172926273_1621002638","id":"20170413-154720_1333871681","dateCreated":"2017-04-26T12:15:26+1000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:447","user":"anonymous","dateFinished":"2017-04-26T14:34:25+1000","dateStarted":"2017-04-26T14:34:25+1000"},{"text":"%sql\n-- transform - minor_purchase\nCREATE OR REPLACE TEMPORARY VIEW minor_purchase AS\nSELECT i.id,\n       i.name,\n       totals.sold_to_minors\n  FROM item i\n       INNER JOIN\n       (SELECT id,\n               SUM(sold_to_minors) AS sold_to_minors\n          FROM (SELECT typed_client.id,\n                       positive_transaction.sold_to_minors\n                  FROM (SELECT id, CAST(age AS INTEGER) FROM client) AS typed_client\n                       INNER JOIN\n                       (SELECT client_id, item_id, quantity AS sold_to_minors FROM (SELECT client_id, item_id, CAST(quantity AS INTEGER) FROM transaction) WHERE quantity > 0) AS positive_transaction\n                       ON positive_transaction.client_id = typed_client.id\n                       INNER JOIN\n                       item\n                       ON positive_transaction.item_id = item.id\n               ) GROUP BY id\n         ) AS totals\n         ON i.id = totals.id","user":"anonymous","dateUpdated":"2017-04-26T14:34:23+1000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":89,"optionOpen":false}}},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493177982105_1818408351","id":"20170426-133942_2106824477","dateCreated":"2017-04-26T13:39:42+1000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3293","dateFinished":"2017-04-26T14:34:25+1000","dateStarted":"2017-04-26T14:34:25+1000","errorMessage":""},{"text":"%sql\n-- transform-check - client_spending\nSELECT -- null checks\n       (SELECT count(1) FROM client_spending WHERE id IS NULL)   = 0 AS id_null_less,\n       (SELECT count(1) FROM client_spending WHERE name IS NULL) = 0 AS name_null_less,\n       -- min checks\n       min(id)             > 0                                       AS id_positive_ok,\n       min(total_spending) > 0                                       AS total_spending_ok,\n       -- col width checks\n       max(length(name))  <= 10                                      AS name_ok\n  FROM client_spending","dateUpdated":"2017-04-26T14:39:34+1000","config":{"enabled":true,"results":{"0":{"graph":{"mode":"table","height":88,"optionOpen":false}}},"editorMode":"ace/mode/sql","editorSetting":{"language":"sql"},"colWidth":12},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493172926273_1621002638","id":"20170313-113649_1655598801","dateCreated":"2017-04-26T12:15:26+1000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:449","user":"anonymous","dateFinished":"2017-04-26T14:34:27+1000","dateStarted":"2017-04-26T14:34:25+1000"},{"text":"%sql\n-- transform-check - item_purchase\nSELECT -- null checks\n       (SELECT count(1) FROM item_purchase WHERE id IS NULL)   = 0 AS id_null_less,\n       (SELECT count(1) FROM item_purchase WHERE name IS NULL) = 0 AS name_null_less,\n       -- min checks\n       min(id)             > 0                                     AS id_positive_ok,\n       min(total_purchase) > 0                                     AS total_purchase_ok,\n       -- col width checks\n       max(length(name))  <= 10                                    AS name_ok\n  FROM item_purchase","dateUpdated":"2017-04-26T14:39:39+1000","config":{"enabled":true,"results":{"0":{"graph":{"mode":"table","height":93,"optionOpen":false}}},"editorMode":"ace/mode/sql","editorSetting":{"language":"sql"},"colWidth":12},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493172926274_1622156884","id":"20170316-102508_793748611","dateCreated":"2017-04-26T12:15:26+1000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:450","user":"anonymous","dateFinished":"2017-04-26T14:34:28+1000","dateStarted":"2017-04-26T14:34:26+1000"},{"text":"%sql\n-- transform-check - minor_purchase\nSELECT -- null checks\n       (SELECT count(1) FROM minor_purchase WHERE id IS NULL)   = 0 AS id_null_less,\n       (SELECT count(1) FROM minor_purchase WHERE name IS NULL) = 0 AS name_null_less,\n       -- min checks\n       min(id)             > 0                                      AS id_positive_ok,\n       min(sold_to_minors) > 0                                      AS sold_to_minors_ok,\n       -- col width checks\n       max(length(name))  <= 10                                     AS name_ok\n  FROM minor_purchase","dateUpdated":"2017-04-26T14:39:40+1000","config":{"enabled":true,"results":{"0":{"graph":{"mode":"table","height":89,"optionOpen":false}}},"editorMode":"ace/mode/sql","editorSetting":{"language":"sql"},"colWidth":12},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493172926274_1622156884","id":"20170413-135140_820386453","dateCreated":"2017-04-26T12:15:26+1000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:451","user":"anonymous","dateFinished":"2017-04-26T14:34:29+1000","dateStarted":"2017-04-26T14:34:27+1000"},{"text":"%sql\n-- report\nSELECT (SELECT count(1) FROM client_spending) AS client_spending_count,\n       (SELECT count(1) FROM item_purchase)   AS item_purchase_count,\n       (SELECT count(1) FROM minor_purchase)  AS minor_purchase_count","dateUpdated":"2017-04-26T14:39:34+1000","config":{"enabled":true,"editorMode":"ace/mode/sql","results":{"0":{"graph":{"mode":"table","height":84,"optionOpen":false}}},"editorSetting":{"language":"sql"},"editorHide":false,"colWidth":12},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493172926273_1621002638","id":"20170309-123816_452023039","dateCreated":"2017-04-26T12:15:26+1000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:448","user":"anonymous","dateFinished":"2017-04-26T14:34:26+1000","dateStarted":"2017-04-26T14:34:25+1000","focus":true}],"name":"Demo","id":"2CE5XVCSW","angularObjects":{"2C9H3ET1N:shared_process":[],"2CG61KY9D:shared_process":[],"2CFTRQBM4:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}